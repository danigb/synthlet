export const PROCESSOR = `(()=>{function P(r){return Object.keys(r).map(e=>{let{min:t,max:o,defaultValue:a}=r[e];return{name:e,minValue:t,maxValue:o,defaultValue:a,automationRate:"k-rate"}})}var s=Math.PI,T=2*s,R=s*s,S=4/s,N=-4/R,v=.225;function w(r){let e=S*r+N*r*Math.abs(r);return v*(e*Math.abs(e)-e)+e}var i=5/12,u=Math.pow(10,-1/i),F=1/(1-u),V=1/(1+i*Math.log10(1+u)),_=1/(1+-Math.pow(10,-1/i)),y=i*Math.log10(1+u),E=1/(-i*Math.log10(u)+y);function h(r){if(r>=1)return 1;if(r<=0)return 0;let e=-i*E*Math.log10(1-r+u)+y;return d(e,0,1)}function d(r,e,t){return Math.max(e,Math.min(t,r))}function n(r){return 2*r-1}function q(r,e){return(e+r%e)%e}function O(r,e,t){return e+q(r-e,t-e)}function M(r,e){return r=d(r,-1,1),Math.floor((r+1)/2*e+.5)/e}var b=class{constructor(e){this.sampleRate=e;this.mcounter=0;this.phaseInc=0;this.phaseOffset=0;this.freqOffset=0;this.freqHz=0;this.mcounter=0,this.phaseOffset=0,this.freqOffset=0}setFrequency(e){this.freqHz=e,this.phaseInc=this.freqHz/this.sampleRate}addPhaseOffset(e,t){this.phaseOffset=e,this.phaseInc>0?this.mcounter+=e:this.mcounter-=e,t&&this.wrapClock()}removePhaseOffset(){this.phaseInc>0?this.mcounter+=-this.phaseOffset:this.mcounter-=-this.phaseOffset}advanceClock(e){this.mcounter+=e*this.phaseInc}wrapClock(){if(this.mcounter>=0&&this.mcounter<=1)return!1;let e=this.mcounter<0;return!e&&this.mcounter<2?this.mcounter-=1:e&&this.mcounter>-1?this.mcounter+=1:this.mcounter=O(this.mcounter,0,1),!0}};var k=class{constructor(e){this.sampleRate=e;this.active=!1;this.value=0}tick(){}};function A(r,e,t){let o=t(),a=t(),p=Math.sqrt(-2*Math.log(o))*Math.cos(2*Math.PI*a);return r+e*p}var x=class{constructor(){this.defaultGeneratorEngine=Math.random;this.pinkNoiseBuffer=[0,0];this.bN=[.99765,-.96362,.46454];this.g_fScale=2/4294967295;this.g_x1=1732584193;this.g_x2=4023233417}doGaussianWhiteNoise(e=0,t=1){return A(e,t,this.defaultGeneratorEngine)}doWhiteNoise(){this.g_x1^=this.g_x2;let e=this.g_x2*this.g_fScale;return this.g_x2+=this.g_x1,e}doPinkNoise(){let e=this.doWhiteNoise();return this.doPinkingFilter(e)}doPinkingFilter(e){return this.bN[0]=.99765*this.bN[0]+e*.099046,this.bN[1]=.963*this.bN[1]+e*.2965164,this.bN[2]=.57*this.bN[2]+e*1.0526913,this.bN[0]+this.bN[1]+this.bN[2]+e*.1848}};var m=class{constructor(){this.counter=0;this.targetValueInSamples=0}resetTimer(){this.counter=0}setExpireSamples(e){this.targetValueInSamples=e}setExpireMilliSec(e,t){this.setExpireSamples(Math.floor(t*(e/1e3)))}getExpireSamples(){return this.targetValueInSamples}timerExpired(){return this.counter>=this.targetValueInSamples}advanceTimer(e=1){this.counter+=e}getTick(){return this.counter}};var l={waveform:0,mode:0,frequency:10,gain:10,quantize:0},c={waveform:{min:0,max:9,defaultValue:l.waveform},frequency:{min:.02,max:200,defaultValue:l.frequency},gain:{min:0,max:1e3,defaultValue:l.gain},quantize:{min:0,max:1e3,defaultValue:l.quantize}},g=class{constructor(e){this.sampleRate=e;this.rshOutputValue=0;this.renderComplete=!1;this.noiseGen=new x;this.params={...l};switch(this.fadeInModulator=new k(e),this.lfoClock=new b(e),this.sampleHoldTimer=new m,this.delayTimer=new m,this.rshOutputValue=this.noiseGen.doWhiteNoise(),this.renderComplete=!1,this.lfoClock.setFrequency(c.frequency.defaultValue),this.params.waveform){case 0:this.lfoClock.addPhaseOffset(.25,!0);break;case 2:case 3:this.lfoClock.addPhaseOffset(.5,!0);break}}fillAudioBuffer(e){for(let t=0;t<e.length;t++)e[t]=this.render(),this.lfoClock.advanceClock(1)}fillControlBuffer(e){let t=this.render();for(let o=0;o<e.length;o++)e[o]=t;this.lfoClock.advanceClock(e.length)}render(){if(this.renderComplete)return 0;if(!this.delayTimer.timerExpired())return this.delayTimer.advanceTimer(),0;if(this.lfoClock.wrapClock()&&this.params.mode===1)return this.renderComplete=!0,0;let t=0;switch(this.params.waveform){case 0:t=1-2*Math.abs(n(this.lfoClock.mcounter));break;case 1:let o=this.lfoClock.mcounter*T-s;t=w(-o);break;case 2:t=n(this.lfoClock.mcounter);break;case 3:t=-n(this.lfoClock.mcounter);break;case 4:t=n(h(this.lfoClock.mcounter));break;case 5:t=n(h(1-this.lfoClock.mcounter));break;case 6:t=n(h(Math.abs(n(this.lfoClock.mcounter))));break;case 7:t=this.lfoClock.mcounter<=.5?1:-1;break;case 8:this.sampleHoldTimer.timerExpired()?(this.rshOutputValue=this.noiseGen.doWhiteNoise(),this.sampleHoldTimer.resetTimer()):this.sampleHoldTimer.advanceTimer(),t=this.rshOutputValue;break;case 9:break;default:throw Error("Unknown waveform: "+this.params.waveform)}return this.fadeInModulator.active&&(t*=this.fadeInModulator.value,this.fadeInModulator.tick()),this.params.quantize&&(t=M(t,this.params.quantize)),t*=this.params.gain,t}setParameters(e,t,o,a){this.params.waveform=d(Math.floor(e),c.waveform.min,c.waveform.max),this.params.gain=o,this.lfoClock.setFrequency(t),this.params.quantize=Math.floor(a),this.params.waveform===8&&this.sampleHoldTimer.setExpireSamples(this.sampleRate/t)}};var D=P(c),C=class extends AudioWorkletProcessor{constructor(){super();this.lfo=new g(sampleRate)}process(t,o,a){this.lfo.setParameters(a.waveform[0],a.frequency[0],a.gain[0],a.quantize[0]);let p=o[0];for(let f=0;f<p.length;f++)this.lfo.fillControlBuffer(p[f]);return!0}static get parameterDescriptors(){return D}};registerProcessor("LfoWorklet",C);})();`;
