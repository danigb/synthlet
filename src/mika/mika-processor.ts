export const PROCESSOR = `(()=>{function P(){let s="k-rate";return[{name:"trigger",defaultValue:0,minValue:0,maxValue:1,automationRate:"k-rate"},{name:"note",defaultValue:60,minValue:0,maxValue:127,automationRate:"k-rate"},...I.map(([e,i,r,t,o])=>({name:e,defaultValue:r,minValue:t,maxValue:o,automationRate:s}))]}var I=[["kOsc1Wave","Oscillator 1 waveform",2,0,7,1],["kOsc1Coarse","Oscillator 1 coarse",0,-24,24,1,"semitones"],["kOsc1Fine","Oscillator 1 fine",0,-1,1,.01,"semitones"],["kOsc1Split","Oscillator 1 split",0,-.025,.025,.01],["kOsc2Wave","Oscillator 2 waveform",2,0,7,1],["kOsc2Coarse","Oscillator 2 coarse",0,-24,24,1,"semitones"],["kOsc2Fine","Oscillator 2 fine",0,-1,1,.01,"semitones"],["kOsc2Split","Oscillator 2 split",0,-.025,.025,.01],["kOscMix","Oscillator mix",1,0,1,.01],["kFmMode","FM mode",0,0,3,1],["kFmCoarse","FM coarse",0,0,48,1],["kFmFine","FM fine",0,-1,1,.01],["kFilterEnabled","Filter enabled",1,0,1,1],["kFilterCutoff","Filter cutoff",8e3,20,8e3,.01,"hz"],["kFilterResonance","Filter resonance",0,0,1,.01],["kFilterKeyTrack","Filter key tracking",0,-1,1,.01],["kVolEnvA","Volume envelope attack",.5,.5,1e3,.01],["kVolEnvD","Volume envelope decay",998,.5,1e3,.01],["kVolEnvS","Volume envelope sustain",1,0,1,.01],["kVolEnvR","Volume envelope release",925,.5,1e3,.01],["kVolEnvV","Volume envelope velocity sensitivity",0,0,1,.01],["kModEnvA","Modulation envelope attack",998,.5,1e3,.01],["kModEnvD","Modulation envelope decay",998,.5,1e3,.01],["kModEnvS","Modulation envelope sustain",.5,0,1,.01],["kModEnvR","Modulation envelope release",998,.5,1e3,.01],["kModEnvV","Modulation envelope velocity sensitivity",0,0,1,.01],["kLfoAmount","Vibrato amount",0,-.1,.1,.01],["kLfoFrequency","Vibrato frequency",4,.1,10,.01],["kLfoDelay","Vibrato delay",.1,.1,1e3,.01],["kVolEnvFm","Volume envelope to FM amount",0,-24,24,.01,"semitones"],["kModEnvFm","Modulation envelope to FM amount",0,-24,24,.01,"semitones"],["kLfoFm","Vibrato to FM amount",0,-24,24,.01,"semitones"],["kVolEnvCutoff","Volume envelope to filter cutoff",0,-8e3,8e3,.01,"hz"],["kModEnvCutoff","Modulation envelope to filter cutoff",0,-8e3,8e3,.01,"hz"],["kLfoCutoff","Vibrato to filter cutoff",0,-8e3,8e3,.01],["kVoiceMode","Voice mode",0,0,2,1],["kGlideSpeed","Glide speed",1,1,1e3,.01],["kGlideEnabled","Glide enabled",0,0,1,1],["kMasterVolume","Master volume",.25,0,.5,.01]];var C=Math.PI*2,S=s=>Math.pow(1.0595,s),A=s=>440*S(s-69),L=s=>s/(1+.28*(s*s));function v(s,e){return s<e?(s/=e,s+s-s*s-1):s>1-e?(s=(s-1)/e,s*s+s+s+1):0}function f(s,e,i){let r=s<i?1:-1;return r+=v(s,e),r-=v((s+(1-i))%1,e),r}var l=123456789,g=362436069,x=521288629;function W(){let s;return l^=l<<16,l^=l>>5,l^=l<<1,s=l,l=g,g=x,x=s^l^g,x}var T=2/4294967295;function D(){return-1+W()*T}var d=class{constructor(){this.driftVelocity=0;this.driftPhase=0}process(e){return this.driftVelocity+=D()*1e4*e,this.driftVelocity-=this.driftVelocity*2*e,this.driftPhase+=this.driftVelocity*e,.001*Math.sin(this.driftPhase)}};var a=class{constructor(e){this.phase=0;this.phaseIncrement=0;this.triCurrent=0;this.triLast=0;this.noiseValue=19.19191919191919;this.waveform=e}process(e,i){for(this.phaseIncrement=i*e,this.phase+=this.phaseIncrement;this.phase>1;)this.phase-=1;return this.calc(this.waveform)}calc(e){switch(e){case 0:return Math.sin(this.phase*C);case 1:return this.triLast=this.triCurrent,this.triCurrent=this.phaseIncrement*f(this.phase,this.phaseIncrement,.5)+(1-this.phaseIncrement)*this.triLast,this.triCurrent*5;case 2:return 1-2*this.phase+v(this.phase,this.phaseIncrement);case 3:return f(this.phase,this.phaseIncrement,.5);case 4:return f(this.phase,this.phaseIncrement,.75);case 5:return this.noiseValue+=19,this.noiseValue*=this.noiseValue,this.noiseValue-=Math.floor(this.noiseValue),this.noiseValue-.5;default:return 0}}getFromWaveform(e,i,r){for(this.phaseIncrement=r*e,this.phase+=this.phaseIncrement;this.phase>1;)this.phase-=1;if(i.switching){let t=0;return t+=(1-i.mix)*this.calc(i.previous),t+=i.mix*this.calc(i.current),t}else return this.calc(i.current)}};var M=class{constructor(){this.band=0;this.low=0}isSilent(){return this.low===0}process(e,i,r,t){let o=2*Math.PI*r*e;o=o>1?1:o<.01?.01:o;let n=1-o*o*o*o*o,c=t>n?n:t,u=i-(this.low+this.band*(1-c));return this.band+=o*u,this.low+=o*this.band,this.low=L(this.low*.1)*10,this.low}};var h=class{constructor(){this.params={a:.1,d:.1,s:.1,r:.1},this.stage=0,this.value=0}start(){this.stage=1}release(){this.stage=3}reset(){this.value=0}getValue(){return this.value}withVelocity(e,i){return this.value*(1+(i-1)*e)}isReleased(){return this.stage==3||this.stage==0}update(e,i,r,t){this.params.a=e,this.params.d=i,this.params.s=r,this.params.r=t}process(e){let{a:i,d:r,s:t,r:o}=this.params;switch(this.stage){case 1:this.value+=(1.1-this.value)*i*e,this.value>=1&&(this.value=1,this.stage=2);break;case 2:this.value+=(t-this.value)*r*e;break;case 3:this.value+=(-.1-this.value)*o*e,this.value<=0&&(this.value=0,this.stage=0);break}}};var F=class{constructor(e){this.note=69;this.targetFrequency=440;this.baseFrequency=440;this.pitchBendFactor=1;this.velocity=1;this.osc1PitchFactor=1;this.osc1SplitFactorA=1;this.osc1SplitFactorB=1;this.osc1bMix=0;this.osc2PitchFactor=1;this.osc2SplitFactorA=1;this.osc2SplitFactorB=1;this.osc2bMix=0;this.filterMix=0;this.osc1a=new a(e.kOsc1Wave),this.osc1b=new a(e.kOsc1Wave),this.osc2a=new a(e.kOsc1Wave),this.osc2b=new a(e.kOsc2Wave),this.oscFm=new a(0),this.modEnv=new h,this.volEnv=new h,this.lfoEnv=new h,this.filter=new M,this.params=e}setParams(e){this.params=e}start(){this.volEnv.start(),this.modEnv.start(),this.lfoEnv.start()}release(){this.volEnv.release(),this.modEnv.release(),this.lfoEnv.release()}setNote(e){this.note=e,this.targetFrequency=A(e)}getNote(){return this.note}process(e,i,r){let t=this.params;this.volEnv.update(t.kVolEnvA,t.kVolEnvD,t.kVolEnvS,t.kVolEnvR),this.modEnv.update(t.kModEnvA,t.kModEnvD,t.kModEnvS,t.kModEnvR),this.lfoEnv.update(t.kLfoDelay,.5,1,.5),this.volEnv.process(e),this.modEnv.process(e),this.lfoEnv.process(e);let o=this.volEnv.withVelocity(t.kVolEnvV,this.velocity),n=this.modEnv.withVelocity(t.kModEnvV,this.velocity);i*=this.lfoEnv.withVelocity(0,this.velocity);let c=t.kGlideEnabled===1?t.kGlideSpeed:.1;this.baseFrequency+=(this.targetFrequency-this.baseFrequency)*c*e;let u=t.kOsc1Split!==0&&this.osc1b.waveform!==5,q=t.kOsc2Split!==0&&this.osc2b.waveform!==5;this.osc1bMix+=((u?1:0)-this.osc1bMix)*100*e,this.osc2bMix+=((q?1:0)-this.osc2bMix)*100*e;let k=this.baseFrequency*this.osc1PitchFactor*this.pitchBendFactor*(1+r);t.kLfoAmount<0&&(k*=1+Math.abs(t.kLfoAmount)*i);let p=this.baseFrequency*this.osc2PitchFactor*this.pitchBendFactor*(1+r);switch(p*=1+Math.abs(t.kLfoAmount)*i,t.kFmMode){case 1:case 2:{let O=t.kFmCoarse+t.kFmFine+t.kVolEnvFm*o+t.kModEnvFm*n+t.kLfoFm*i,b=S(this.oscFm.process(e,k)*O);switch(t.kFmMode){case 1:k*=b;break;case 2:p*=b;break}break}}let m=0,V=0;t.kOscMix<.99&&(V+=this.osc1a.process(e,k*this.osc1SplitFactorA),this.osc1bMix>.01&&(V+=this.osc1bMix*this.osc1b.process(e,k*this.osc1SplitFactorB)),m+=V*Math.sqrt(1-t.kOscMix));let y=0;if(t.kOscMix>.01&&(y+=this.osc2a.process(e,p*this.osc2SplitFactorA),this.osc2bMix>.01&&(y+=this.osc2bMix*this.osc2b.process(e,p*this.osc2SplitFactorB)),m+=y*Math.sqrt(t.kOscMix)),m*=o,this.filterMix+=((t.kFilterEnabled?1:0)-this.filterMix)*100*e,this.filterMix>.01){let O=this._getFilterCutoff(o,n,i,r),b=this.filter.process(e,m,O,t.kFilterResonance);m=m*(1-this.filterMix)+b*this.filterMix}return m}_getFilterCutoff(e,i,r,t){let o=this.params,n=o.kFilterCutoff;return n*=1+t,n+=o.kVolEnvCutoff*e,n+=o.kModEnvCutoff*i,n+=r*o.kLfoCutoff,n+=o.kFilterKeyTrack*this.baseFrequency*this.pitchBendFactor,n}};var E=class{constructor(e){this.params=e,this.voice=new F(e),this.lfo=new a(0),this.drift=new d}setParams(e){this.params=e,this.voice.setParams(e)}start(){this.voice.start()}release(){this.voice.release()}setNote(e){this.voice.setNote(e)}process(e){let i=this.lfo.process(e,this.params.kLfoFrequency),r=this.drift.process(e);return this.voice.process(e,i,r)*this.params.kMasterVolume}};var R={name:"Default - Mika",params:{kOsc1Wave:2,kOsc1Coarse:0,kOsc1Fine:-.210938,kOsc1Split:.004883,kOsc2Wave:0,kOsc2Coarse:0,kOsc2Fine:0,kOsc2Split:-.005273,kOscMix:.527778,kFmMode:1,kFmCoarse:4,kFmFine:0,kFilterEnabled:1,kFilterCutoff:200,kFilterResonance:.953125,kFilterKeyTrack:1,kVolEnvA:.5,kVolEnvD:999.296328,kVolEnvS:0,kVolEnvR:99.447572,kVolEnvV:1,kModEnvA:.5,kModEnvD:998,kModEnvS:0,kModEnvR:998,kModEnvV:0,kLfoAmount:-.00625,kLfoFrequency:1.723765,kLfoDelay:.1,kVolEnvFm:0,kVolEnvCutoff:0,kModEnvFm:-5.0625,kModEnvCutoff:0,kLfoFm:0,kLfoCutoff:0,kVoiceMode:0,kGlideSpeed:1,kGlideEnabled:0,kMasterVolume:.123047}},w=class extends AudioWorkletProcessor{constructor(){super();this.debug=0;this.synth=new E(R.params),this.dt=1/sampleRate,this.port.postMessage(R),this.started=!1,this.port.onmessage=i=>{let{type:r,params:t}=i.data;r==="preset-change"&&this.synth.setParams(t)}}process(i,r,t){let o=t.trigger[0];o!==0&&!this.started?(this.started=!0,this.synth.start()):o===0&&this.started&&(this.started=!1,this.synth.release());let n=t.note[0];this.synth.setNote(n);let c=r[0][0];for(let u=0;u<c.length;u++)c[u]=this.synth.process(this.dt);return this.debug++,this.debug===1e3&&(this.port.postMessage({type:"debug",debug:c[0]}),this.debug=0),!0}static get parameterDescriptors(){return P()}};registerProcessor("MikaWorklet",w);})();`;
