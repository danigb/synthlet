export const PROCESSOR = `(()=>{function C(i){return Object.keys(i).map(e=>{let{min:t,max:r,def:a}=i[e];return{name:e,minValue:t,maxValue:r,defaultValue:a,automationRate:"k-rate"}})}var l={gate:{min:0,max:1,def:0},attack:{min:0,max:10,def:.01},decay:{min:0,max:10,def:.1},sustain:{min:0,max:1,def:.5},release:{min:0,max:10,def:.3}},f=class{constructor(e){this.sampleRate=e;this.state=0,this.open=!1,this.output=0,this.attackTime=0,this.decayTime=0,this.releaseTime=0,this.attackCoef=0,this.attackTCO=Math.exp(-1.5),this.decayTCO=Math.exp(-4.95),this.releaseTCO=this.decayTCO,this.setParams(0,l.attack.def,l.decay.def,l.sustain.def,l.release.def)}setGate(e){let t=!!e;this.open!==t&&(this.open=t,t?this.state=1:this.state!==0&&(this.state=4))}setParams(e,t,r,a,n){this.setGate(e),this.setSustainLevel(a),this.setAttackTime(t),this.setDecayTime(r),this.setReleaseTime(n)}process(){switch(this.state){case 0:break;case 1:this.output=this.attackBase+this.output*this.attackCoef,(this.output>=1||this.attackTime<=0)&&(this.output=1,this.state=2);break;case 2:this.output=this.decayBase+this.output*this.decayCoef,(this.output<=this.sustainLevel||this.decayTime<=0)&&(this.output=this.sustainLevel,this.state=3);break;case 3:this.output=this.sustainLevel;break;case 4:this.output=this.releaseBase+this.output*this.releaseCoef,(this.output<=0||this.releaseTime<=0)&&(this.output=0,this.state=0)}return this.output}setSustainLevel(e){this.sustainLevel!==e&&(this.sustainLevel=e,this.decayTime=-1)}setAttackTime(e){if(this.attackTime===e)return;this.attackTime=e;let t=this.sampleRate*e,r=this.attackTCO;this.attackCoef=Math.exp(-Math.log((1+r)/r)/t),this.attackBase=(1+r)*(1-this.attackCoef)}setDecayTime(e){if(this.decayTime===e)return;this.decayTime=e;let t=this.sampleRate*e,r=this.decayTCO;this.decayCoef=Math.exp(-Math.log((1+r)/r)/t),this.decayBase=(this.sustainLevel-r)*(1-this.decayCoef)}setReleaseTime(e){if(this.releaseTime===e)return;this.releaseTime=e;let t=this.sampleRate*e,r=this.releaseTCO;this.releaseCoef=Math.exp(-Math.log((1+r)/r)/t),this.releaseBase=-r*(1-this.releaseCoef)}};var d=Math.PI,W=2*d,D=d*d,c=1e-9,k=Math.max;var w=4/d,F=-4/D;var h=5/12,b=Math.pow(10,-1/h),E=1/(1-b),$=1/(1+h*Math.log10(1+b)),j=1/(1+-Math.pow(10,-1/h)),L=h*Math.log10(1+b),U=1/(-h*Math.log10(b)+L);function A(i,e,t){return Math.max(e,Math.min(t,i))}var y=class{constructor(){this.hi=!1}process(e,t=0,r=1){return this.hi=e>=1&&!this.hi,this.hi}};function v(i){let e=!1,t=!1,r=!1,a=new y,n=0,m=0,o=0,p=0,s=0;function u(T,O,M,g,R){e=T>=1,a.process(T)&&(t=!0,r=!0),o=g,n=A(1/(c+i*O),c,.5),m=k(-.5,(o-1)/(c+i*M)),p=k(-1,-(o+c)/(c+i*R))}function P(){return r?(e?t?(s+=n,s>=1&&(s=1,t=!1)):s<o+.001?s=o:s+=m:(s+=p,s<=p&&(r=!1)),s):0}return{setParams:u,process:P}}var S={gate:{min:0,max:1,def:0},attack:{min:0,max:10,def:.01},decay:{min:0,max:10,def:.1},sustain:{min:0,max:1,def:.5},release:{min:0,max:10,def:.3}},N=C(S),x=class extends AudioWorkletProcessor{constructor(t){super();this.#e(t?.processorOptions?.type==="linear"?"linear":"exp"),this.port.onmessage=r=>{let a=r.data?.type==="linear"?"linear":"exp";this.t!==a&&this.#e(a)}}#e(t){this.t=t,this.p=t==="linear"?v(sampleRate):new f(sampleRate),this.p.setParams(0,.01,.1,.5,.3)}process(t,r,a){this.p.setParams(a.gate[0],a.attack[0],a.decay[0],a.sustain[0],a.release[0]);let n=t[0],m=r[0],o=Math.min(n.length,m.length);if(o===0)return!0;let p=n[0].length;for(let s=0;s<p;s++)for(let u=0;u<o;u++)m[u][s]=n[u][s]*this.p.process();return!0}static get parameterDescriptors(){return N}};registerProcessor("AdsrWorklet",x);})();`;
